server {
    listen 8080;
    server_name localhost;

    # Security
    server_tokens off;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer" always;

    # Timeouts and body limits
    keepalive_timeout 10;
    send_timeout 10;
    client_max_body_size 50m;
    client_body_timeout 10;
    client_header_timeout 10;

    # Hide upstream headers if proxying is used in the future
    proxy_hide_header Server;
    proxy_hide_header X-Powered-By;
    proxy_hide_header X-Runtime;

    # Log level
    error_log /dev/stderr info;

    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
    }

    location = /config.js {
      root /usr/share/nginx/html;
      # From the MDN documentation:
      # The no-cache response directive indicates that the response CAN be stored in caches, 
      # but the response MUST be validated with the origin server before each reuse
      add_header Cache-Control "no-cache" always;

      # Necessary here because we are setting at least one header (cache-control) so
      # The headers are not inherited from the parent settings
      add_header Cross-Origin-Opener-Policy "same-origin" always;
      add_header Cross-Origin-Embedder-Policy "require-corp" always;
  }

    # Required headers for SharedArrayBuffer / cross-origin isolation
    add_header Cross-Origin-Opener-Policy "same-origin" always;
    add_header Cross-Origin-Embedder-Policy "require-corp" always;

    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}